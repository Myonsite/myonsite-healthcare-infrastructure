# Health Platform – AI-Managed Kubernetes Stack

This repository contains **infrastructure-as-code** that lets you run a full production-shape Kubernetes environment on your laptop (via `kind`) and in AWS (via EKS) with _zero manual steps_ beyond approving pull-requests generated by the AI agents.

## Requirements

1. Docker ≥ 24
2. `kind` ≥ v0.23 (install: `go install sigs.k8s.io/kind@v0.23.0`)
3. `kubectl` ≥ 1.30
4. GNU Make

> The Makefile ships convenience targets that wrap the underlying tooling.

## Quick start (local)

```bash
# Spin up a 3-node kind cluster and install the stack
make dev-up

# Tail the status of all components
kubectl get pods -A -w

# Tear everything down
make dev-down
```

Behind the scenes, the following happens:

1. `kind create cluster --config infra/kind-3node.yaml`
2. Flux bootstrap against the **local** `clusters/local` kustomization overlay
3. Helm charts for common services (MySQL, Postgres, Redis, Harbor, Apache AGE, Prometheus stack, Loki, Velero, Kured) are installed

## Production (EKS)

An AI agent will open a pull-request that generates the EKS cluster via Terraform or CDK, then bootstrap Flux in the same way using `clusters/prod`.  Once approved & merged, production stays in continuous sync with Git.

## Directory layout

```
infra/
  kind-3node.yaml        # kind cluster definition (3 workers)
  clusters/
    base/                # common manifests shared by all envs
    local/               # overlay patches for local dev
    prod/                # overlay patches for EKS (to be generated)
charts/                  # Custom Helm charts we own (optional)
```

## Contributing

All infra changes should be made via pull-request.  The GitHub Copilot-Agent monitors the repo and will propose fixes or upgrades automatically.  Human approval (CODEOWNERS) is required for protected paths. 